function pauseGame(){if(PLAYSOUND){GLOB_in_menu.stop();PAUSED=true}}function resumeGame(){if(PLAYSOUND&&PAUSED){GLOB_in_menu.play("none",0,0,-1)}PAUSED=false}function ytytq(){function s(){this.RUN=false;this.INTRO_SHOWED=false;this.AFTER_INTRO=false;this.STEPS=0;this.STEP1=0;this.STEP2=0;this.STEP3=0;this.SHOW_HANDLER=null;this.WND_TITLE=null;this.WND_GAME=null;this.WND_LEVELS=null;this.CURRENT_LEVEL=0;this.EL_WIDTH=0;this.EL_HEIGHT=0;this.ELEMENT=null;this.MAP_X=0;this.MAP_Y=0;this.MAP_WIDTH=0;this.MAP_HEIGHT=0;this.START_X=-1;this.START_Y=0;this.MAX_ARRAY=5;this.SUFIX="";this.MOVE_TICK=200;this.EDIT_X=0;this.EDIT_Y=0;this.PROG=0;this.SKACHKA=false;this.PLAY_SND=true;this.WND_EMITTERS;this.PRINCESS_PAUSE=0;this.PATH=new Array(2*this.MAX_ARRAY*this.MAX_ARRAY);this.PROGRESS=[-1,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2];this.CLOUDS=[];this.API=0;this.LINK=0;this.LEVELS=[];this.LOG=function(e){c.MAIN.txt_log.set_text(c.MAIN.txt_log.caption+"\n"+e);c.MAIN.txt_log.sprite.position.y=c.MAIN.txt_log.y+(c.MAIN.log_place.uni_height-c.MAIN.txt_log.txt.textHeight);c.MAIN.txt_log.txt.position.y=0};var e=(new Date).getTime();this.FUNC=function(t){var n=(new Date).getTime();c.MAIN.txt_log.set_text(c.MAIN.txt_log.caption+"\n"+t+"["+(n-e)+"]");e=n;c.MAIN.txt_log.sprite.position.y=c.MAIN.txt_log.y+(c.MAIN.log_place.uni_height-c.MAIN.txt_log.txt.textHeight);c.MAIN.txt_log.txt.position.y=0}}function u(e){o.API=e}function p(){try{localStorage.avk_tew_data=o.PROGRESS}catch(e){}d()}function d(){try{if(typeof localStorage.avk_tew_data=="undefined"){localStorage.avk_tew_data=o.PROGRESS}var e=0;var t=0;var n=localStorage.avk_tew_data+",";for(var r=0;r<n.length;r++){if(n[r]==","){o.PROGRESS[t]=n.substring(e,r)/1;e=r+1;t++}}}catch(i){}for(r=1;r<21;r++){c.LEVELS["btn_lev_"+r].sprite.visible=o.PROGRESS[r-1]>-2;c.LEVELS["z_"+r+"_1"].sprite.visible=o.PROGRESS[r-1]>0;c.LEVELS["z_"+r+"_2"].sprite.visible=o.PROGRESS[r-1]>1;c.LEVELS["z_"+r+"_3"].sprite.visible=o.PROGRESS[r-1]>2;c.LEVELS["zz_"+r+"_1"].sprite.visible=o.PROGRESS[r-1]>0;c.LEVELS["zz_"+r+"_2"].sprite.visible=o.PROGRESS[r-1]>1;c.LEVELS["zz_"+r+"_3"].sprite.visible=o.PROGRESS[r-1]>2;c.LEVELS["lock_"+r].sprite.visible=!c.LEVELS["btn_lev_"+r].sprite.visible;if(c.LEVELS["btn_lev_"+r].sprite.visible)o.WND_TITLE.level_btn=c.LEVELS["btn_lev_"+r]}}function v(e){c.GUI_BUSY=true;f.push(e);e.sprite.visible=true;e.sprite.position.x=c.SCREEN_WIDTH;c.ACT.start("from_left",e);c.ACT.start("to_right",f[f.length-2],w)}function m(e){c.GUI_BUSY=true;f.push(e);e.sprite.visible=true;e.sprite.position.x=c.SCREEN_WIDTH;c.ACT.start("from_right",e,b);c.ACT.start("to_left",f[f.length-2],w)}function g(){c.GUI_BUSY=true;f[f.length-2].sprite.visible=true;c.ACT.start("from_right",f[f.length-2]);c.ACT.start("to_left",f[f.length-1],w);f.pop()}function y(){c.GUI_BUSY=true;f[f.length-2].sprite.visible=true;c.ACT.start("from_left",f[f.length-2]);c.ACT.start("to_right",f[f.length-1],w);f.pop()}function b(){if(o.SHOW_HANDLER!=null){o.SHOW_HANDLER();o.SHOW_HANDLER=null}}function w(e){c.GUI_BUSY=false;PAUSE=false;e.sprite.visible=false}function E(e){var t="";var n=0;e=""+e;for(var r=e.length-1;r>=0;r--){if(n==3){n=0;t=" "+t}if(e.charAt(r)!="0"&&e.charAt(r)!="1"&&e.charAt(r)!="2"&&e.charAt(r)!="3"&&e.charAt(r)!="4"&&e.charAt(r)!="5"&&e.charAt(r)!="6"&&e.charAt(r)!="7"&&e.charAt(r)!="8"&&e.charAt(r)!="9")return e;t=e.charAt(r)+t;n++}return t}function S(){var e={};var t=this;this.init=function(e,t){e.active=1;e.sprite.visible=true;if(t!=null)t.add(e);return e};this.free=function(e){e.active=0;e.sprite.visible=false;if(e.sprite.parent!=null)e.sprite.parent.removeChild(e.sprite);return e};this.get_object=function(n,r,i){if(e[n+"_"+r]==null)e[n+"_"+r]=[];for(var s=0;s<e[n+"_"+r].length;s++)if(e[n+"_"+r][s].active<=0)return t.init(e[n+"_"+r][s],i);if(e[n+"_"+r].length==0){c[n][r].ID=0;e[n+"_"+r].push(c[n][r]);return t.init(c[n][r],i)}else{e[n+"_"+r].push(e[n+"_"+r][e[n+"_"+r].length-1].make_copy());return t.init(e[n+"_"+r][e[n+"_"+r].length-1],i)}}}function T(){PLAYSOUND=c.GAME.btn_snd.sprite.visible;return c.GAME.btn_snd.sprite.visible}function N(){if(GLOB_M){o.PLAY_SND=!o.PLAY_SND}else{o.PLAY_SND=false}c.GAME.btn_snd.sprite.visible=o.PLAY_SND;c.GAME.btn_no_snd.sprite.visible=!o.PLAY_SND;c.GAME.btn_snd.down_sprite.visible=false;c.GAME.btn_no_snd.down_sprite.visible=false;if(c.GAME.btn_snd.sprite.visible){c.GAME.sprite.addChild(c.GAME.btn_snd.sprite);c.GAME.sprite.addChild(c.GAME.btn_snd.down_sprite);c.GAME.sprite.removeChild(c.GAME.btn_no_snd.sprite);c.GAME.sprite.removeChild(c.GAME.btn_no_snd.down_sprite)}else{c.GAME.sprite.removeChild(c.GAME.btn_snd.sprite);c.GAME.sprite.removeChild(c.GAME.btn_snd.down_sprite);c.GAME.sprite.addChild(c.GAME.btn_no_snd.sprite);c.GAME.sprite.addChild(c.GAME.btn_no_snd.down_sprite)}c.MAIN.btn_snd.sprite.visible=o.PLAY_SND;c.MAIN.btn_no_snd.sprite.visible=!o.PLAY_SND;c.MAIN.btn_snd.down_sprite.visible=false;c.MAIN.btn_no_snd.down_sprite.visible=false;if(c.MAIN.btn_snd.sprite.visible){c.MAIN.sprite.addChild(c.MAIN.btn_snd.sprite);c.MAIN.sprite.addChild(c.MAIN.btn_snd.down_sprite);c.MAIN.sprite.removeChild(c.MAIN.btn_no_snd.sprite);c.MAIN.sprite.removeChild(c.MAIN.btn_no_snd.down_sprite)}else{c.MAIN.sprite.removeChild(c.MAIN.btn_snd.sprite);c.MAIN.sprite.removeChild(c.MAIN.btn_snd.down_sprite);c.MAIN.sprite.addChild(c.MAIN.btn_no_snd.sprite);c.MAIN.sprite.addChild(c.MAIN.btn_no_snd.down_sprite)}c.CREDITS.btn_snd.sprite.visible=o.PLAY_SND;c.CREDITS.btn_no_snd.sprite.visible=!o.PLAY_SND;c.CREDITS.btn_snd.down_sprite.visible=false;c.CREDITS.btn_no_snd.down_sprite.visible=false;if(c.CREDITS.btn_snd.sprite.visible){c.CREDITS.sprite.addChild(c.CREDITS.btn_snd.sprite);c.CREDITS.sprite.addChild(c.CREDITS.btn_snd.down_sprite);c.CREDITS.sprite.removeChild(c.CREDITS.btn_no_snd.sprite);c.CREDITS.sprite.removeChild(c.CREDITS.btn_no_snd.down_sprite)}else{c.CREDITS.sprite.removeChild(c.CREDITS.btn_snd.sprite);c.CREDITS.sprite.removeChild(c.CREDITS.btn_snd.down_sprite);c.CREDITS.sprite.addChild(c.CREDITS.btn_no_snd.sprite);c.CREDITS.sprite.addChild(c.CREDITS.btn_no_snd.down_sprite)}c.LEVELS.btn_snd.sprite.visible=o.PLAY_SND;c.LEVELS.btn_no_snd.sprite.visible=!o.PLAY_SND;c.LEVELS.btn_snd.down_sprite.visible=false;c.LEVELS.btn_no_snd.down_sprite.visible=false;if(c.LEVELS.btn_snd.sprite.visible){c.LEVELS.sprite.addChild(c.LEVELS.btn_snd.sprite);c.LEVELS.sprite.addChild(c.LEVELS.btn_snd.down_sprite);c.LEVELS.sprite.removeChild(c.LEVELS.btn_no_snd.sprite);c.LEVELS.sprite.removeChild(c.LEVELS.btn_no_snd.down_sprite)}else{c.LEVELS.sprite.removeChild(c.LEVELS.btn_snd.sprite);c.LEVELS.sprite.removeChild(c.LEVELS.btn_snd.down_sprite);c.LEVELS.sprite.addChild(c.LEVELS.btn_no_snd.sprite);c.LEVELS.sprite.addChild(c.LEVELS.btn_no_snd.down_sprite)}c.INTRO.btn_snd.sprite.visible=o.PLAY_SND;c.INTRO.btn_no_snd.sprite.visible=!o.PLAY_SND;c.INTRO.btn_snd.down_sprite.visible=false;c.INTRO.btn_no_snd.down_sprite.visible=false;if(c.INTRO.btn_snd.sprite.visible){c.INTRO.sprite.addChild(c.INTRO.btn_snd.sprite);c.INTRO.sprite.addChild(c.INTRO.btn_snd.down_sprite);c.INTRO.sprite.removeChild(c.INTRO.btn_no_snd.sprite);c.INTRO.sprite.removeChild(c.INTRO.btn_no_snd.down_sprite)}else{c.INTRO.sprite.removeChild(c.INTRO.btn_snd.sprite);c.INTRO.sprite.removeChild(c.INTRO.btn_snd.down_sprite);c.INTRO.sprite.addChild(c.INTRO.btn_no_snd.sprite);c.INTRO.sprite.addChild(c.INTRO.btn_no_snd.down_sprite)}GLOB_in_menu.stop();if(T())GLOB_in_menu.play("none",0,0,-1)}function C(){function t(){c.TITLE.sprite.visible=true;f.push(c.TITLE)}if(GLOB_M){if(GLOB_in_menu==0)GLOB_M=false}c.ACT.init(h);c.LANGUAGE="TXT";c.init_captions();o.WND_TITLE=new _;o.WND_GAME=new D;o.WND_LEVELS=new H;o.WND_CREDITS=new P;x.free(x.get_object("GAME","block_3",c.GAME.game_place));c.GAME.start_3.sprite.visible=false;c.GAME.finish_3.sprite.visible=false;c.INTRO.up.sprite.scale.x=c.SCREEN_WIDTH/c.INTRO.up.uni_width*1.2;c.INTRO.up.sprite.position.x=-5;c.GAME.wrays.sprite.scale.x=5;c.GAME.wrays.sprite.scale.y=5;c.GAME.wrays.sprite.anchor.x=.5;c.GAME.wrays.sprite.anchor.y=.5;c.GAME.wrays.sprite.position.x+=c.GAME.wrays.uni_width/2;c.GAME.wrays.sprite.position.y+=c.GAME.wrays.uni_height/2;c.GAME.win.y=c.GAME.win.sprite.position.y;c.INTRO.btn_start.add_active(c.INTRO.start_btn.sprite);c.INTRO.btn_snd.add_active(c.INTRO.snd_btn.sprite);c.INTRO.btn_no_snd.add_active(c.INTRO.no_snd_btn.sprite);c.INTRO.btn_no_snd.sprite.visible=false;c.MAIN.btn_start.add_active(c.MAIN.start_btn.sprite);c.MAIN.btn_more.add_active(c.MAIN.more_btn.sprite);c.MAIN.btn_credits.add_active(c.MAIN.credits_btn.sprite);c.MAIN.btn_snd.add_active(c.MAIN.snd_btn.sprite);c.MAIN.btn_no_snd.add_active(c.MAIN.no_snd_btn.sprite);c.MAIN.btn_no_snd.sprite.visible=false;c.GAME.btn_next_win.add_active(c.GAME.next_btn_win.sprite);c.GAME.btn_more.add_active(c.GAME.more_btn.sprite);c.GAME.btn_restart.add_active(c.GAME.restart_btn.sprite);c.GAME.btn_close.add_active(c.GAME.close_btn.sprite);c.GAME.btn_close_win.add_active(c.GAME.close_btn_win.sprite);c.GAME.btn_new_close_win.add_active(c.GAME.new_close_btn_win.sprite);c.GAME.btn_edit.sprite.visible=false;c.TITLE.btn_start.add_active(c.TITLE.start_btn.sprite);c.CREDITS.btn_start.add_active(c.CREDITS.start_btn.sprite);c.CREDITS.btn_snd.add_active(c.CREDITS.snd_btn.sprite);c.CREDITS.btn_no_snd.add_active(c.CREDITS.no_snd_btn.sprite);c.CREDITS.btn_no_snd.sprite.visible=false;for(var e=1;e<21;e++){c.LEVELS["btn_lev_"+e].add_active(c.LEVELS["lev_btn_"+e].sprite);c.LEVELS["btn_lev_"+e].center()}c.LEVELS.btn_close.add_active(c.LEVELS.close_btn.sprite);c.LEVELS.btn_snd.add_active(c.LEVELS.snd_btn.sprite);c.LEVELS.btn_no_snd.add_active(c.LEVELS.no_snd_btn.sprite);c.LEVELS.btn_no_snd.sprite.visible=false;c.GAME.btn_snd.add_active(c.GAME.snd_btn.sprite);c.GAME.btn_no_snd.add_active(c.GAME.no_snd_btn.sprite);c.GAME.btn_no_snd.sprite.visible=false;c.GAME.txt_level.set_style(1,"AVK_FNT_main","center");c.GAME.txt_moves.set_style(1.2,"AVK_FNT_main","center");c.GAME.txt_step_1.set_style(1.5,"AVK_FNT_main","center");c.GAME.txt_step_2.set_style(1.5,"AVK_FNT_main","center");c.GAME.txt_step_3.set_style(1.5,"AVK_FNT_main","center");c.GAME.back.sprite.interactive=true;c.GAME.back.sprite.mousemove=c.GAME.back.sprite.touchmove=c.GAME.back.sprite.touch=function(e){if(!o.RUN)return;A("move","GLOBAL","GLOBAL",e.global.x/c.GUI.scale.x,(e.global.y-c.GUI.position.y)/c.GUI.scale.y)};c.GAME.back.sprite.mouseout=c.GAME.back.sprite.mouseupoutside=c.GAME.back.sprite.mouseclick=c.GAME.back.sprite.mouseup=c.GAME.back.sprite.touchend=c.GAME.back.spritemouseupoutside=c.GAME.back.sprite.touchendoutside=function(e){if(!o.RUN)return;A("finish","GLOBAL","GLOBAL",e.global.x/c.GUI.scale.x,(e.global.y-c.GUI.position.y)/c.GUI.scale.y)};c.GAME.back.sprite.mousedown=c.GAME.back.sprite.touchstart=function(e){if(!o.RUN)return;A("start","GLOBAL","GLOBAL",e.global.x/c.GUI.scale.x,(e.global.y-c.GUI.position.y)/c.GUI.scale.y)};c.GAME.princess_place.add(c.PRINCESS.prnc);c.GAME.hero_place.add(c.HERO_S.stay);c.HERO_S.go.sprite.visible=false;c.HERO_S.stay.time=6e3;c.HERO_S.go.time=200;c.BACK_SPR.addChild(c.MAIN.back.sprite);o.CLOUDS.push(c.MAIN.cl_0.sprite);c.BACK_SPR.addChild(o.CLOUDS[o.CLOUDS.length-1]);o.CLOUDS.push(c.MAIN.cl_0.make_copy().sprite);c.BACK_SPR.addChild(o.CLOUDS[o.CLOUDS.length-1]);o.CLOUDS.push(c.MAIN.cl_1.sprite);c.BACK_SPR.addChild(o.CLOUDS[o.CLOUDS.length-1]);o.CLOUDS.push(c.MAIN.cl_1.make_copy().sprite);c.BACK_SPR.addChild(o.CLOUDS[o.CLOUDS.length-1]);o.CLOUDS.push(c.MAIN.cl_2.sprite);c.BACK_SPR.addChild(o.CLOUDS[o.CLOUDS.length-1]);o.WND_EMITTERS=new M;for(e=0;e<o.CLOUDS.length;e++){o.CLOUDS[e].position.x=Math.random()*c.SCREEN_WIDTH*2-c.SCREEN_WIDTH;o.CLOUDS[e].position.y=Math.random()*c.SCREEN_HEIGHT/2-c.SCREEN_HEIGHT*.2;o.CLOUDS[e].speed=Math.random()*30+30}c.LEVELS.btn_add.sprite.visible=false;d();c.GAME.sled.sprite.visible=false;c.GAME.zv1.y=c.GAME.zv1.sprite.position.y;c.GAME.zv2.y=c.GAME.zv2.sprite.position.y;c.GAME.zv3.y=c.GAME.zv3.sprite.position.y;c.GAME.win.x=c.GAME.win.sprite.position.x;c.GAME.win.y=c.GAME.win.sprite.position.y;for(e=1;e<7;e++){c.INTRO["s_1_"+e].x=c.INTRO["s_1_"+e].sprite.position.x;c.INTRO["s_1_"+e].y=c.INTRO["s_1_"+e].sprite.position.y}if(!GLOB_M){c.GAME.btn_snd.sprite.visible=false;c.GAME.btn_no_snd.sprite.visible=false;c.GAME.btn_snd.down_sprite.visible=false;c.GAME.btn_no_snd.down_sprite.visible=false;c.MAIN.btn_snd.sprite.visible=false;c.MAIN.btn_no_snd.sprite.visible=false;c.MAIN.btn_snd.down_sprite.visible=false;c.MAIN.btn_no_snd.down_sprite.visible=false;c.CREDITS.btn_snd.sprite.visible=false;c.CREDITS.btn_no_snd.sprite.visible=false;c.CREDITS.btn_snd.down_sprite.visible=false;c.CREDITS.btn_no_snd.down_sprite.visible=false;c.LEVELS.btn_snd.sprite.visible=false;c.LEVELS.btn_no_snd.sprite.visible=false;c.LEVELS.btn_snd.down_sprite.visible=false;c.LEVELS.btn_no_snd.down_sprite.visible=false;c.INTRO.btn_snd.sprite.visible=false;c.INTRO.btn_no_snd.sprite.visible=false;c.INTRO.btn_snd.down_sprite.visible=false;c.INTRO.btn_no_snd.down_sprite.visible=false}if(o.API!=0){o.API.Branding.displaySplashScreen(t);var n=o.API.Branding.getLogo();if(n.image){var r=PIXI.Texture.fromImage(n.image);var i=new PIXI.Sprite(r);i.buttonMode=true;i.interactive=true;i.click=i.tap=function(e){n.action();e.originalEvent.stopPropagation();e.originalEvent.preventDefault()};c.UP_SPR.addChild(i)}o.LINK=o.API.Branding.getLink("more_games");var s=document.createElement("a");s.ontouchend=o.LINK.action;s.setAttribute("id","spilgames-more-games-btn");document.body.appendChild(s)}else t()}function k(e){function t(e){if(e.visible){if(e!=c.GAME.wrays.sprite)e.rotation=1e-9;for(var n=0;n<e.children.length;n++)t(e.children[n])}}if(e>200)e=200;for(n=0;n<o.CLOUDS.length;n++){o.CLOUDS[n].position.x-=o.CLOUDS[n].speed*e/1e3;if(o.CLOUDS[n].position.x<-c.SCREEN_WIDTH){o.CLOUDS[n].position.x=c.SCREEN_WIDTH;o.CLOUDS[n].position.y=Math.random()*c.SCREEN_HEIGHT/2-c.SCREEN_HEIGHT*.2;o.CLOUDS[n].speed=Math.random()*30+30}}if(o.AFTER_INTRO)t(c.GUI);for(var n=0;n<l.length;n++){l[n](e)}}function L(e){l.push(e)}function A(e,t,n,r,i){if(c.GUI_BUSY)return;if(e=="click"){switch(t){case"LEVELS":switch(n){case"btn_add":o.WND_LEVELS.add_level();break}break;case"GAME":switch(n){case"btn_change":o.WND_LEVELS.change();break;case"btn_edit_erase":o.WND_LEVELS.erase();break;case"btn_edit_nail":o.WND_LEVELS.nail();break;case"btn_edit_up":o.WND_LEVELS.set_path(1);break;case"btn_edit_right":o.WND_LEVELS.set_path(2);break;case"btn_edit_down":o.WND_LEVELS.set_path(4);break;case"btn_edit_left":o.WND_LEVELS.set_path(8);break;case"btn_edit_chain_up":o.WND_LEVELS.set_chain(1);break;case"btn_edit_chain_right":o.WND_LEVELS.set_chain(2);break;case"btn_edit_chain_down":o.WND_LEVELS.set_chain(4);break;case"btn_edit_chain_left":o.WND_LEVELS.set_chain(8);break;case"btn_close_win":o.WND_GAME.close();break;case"btn_edit":o.WND_LEVELS.edit();break;case"btn_edit_save":o.WND_LEVELS.save();break}break}}else if(e=="up"){switch(t){case"LEVELS":if(n.substring(0,8)=="btn_lev_"){o.CURRENT_LEVEL=n.substring(8,n.length)*1-1;o.WND_GAME.show()}switch(n){case"btn_close":o.WND_LEVELS.close();break;case"btn_start":o.CURRENT_LEVEL=r;o.WND_GAME.show();break;case"btn_no_snd":case"btn_snd":N();break}break;case"INTRO":switch(n){case"btn_start":o.WND_LEVELS.show();break;case"btn_no_snd":case"btn_snd":N();break}break;case"CREDITS":switch(n){case"btn_start":o.WND_CREDITS.close();break;case"btn_no_snd":case"btn_snd":N();break}break;case"TITLE":switch(n){case"btn_start":if(T())GLOB_in_menu.play("none",0,0,-1);c.clear();m(c.MAIN);break}break;case"MAIN":switch(n){case"btn_more":if(o.LINK!=0){Play68.goHome()}break;case"btn_credits":o.WND_CREDITS.show();break;case"btn_start":if(!o.INTRO_SHOWED){m(c.INTRO);o.WND_INTRO.start()}else{o.WND_LEVELS.show()}break;case"btn_no_snd":case"btn_snd":N();break}break;case"GAME":switch(n){case"btn_more":if(o.LINK!=0){play68_submitScore(window._myScorePlay68)}break;case"btn_restart":o.WND_GAME.restart();break;case"btn_next_win":o.WND_GAME.next();if(o.API!=0)o.API.GameBreak.request(pauseGame,resumeGame);break;case"btn_new_close_win":case"btn_close_win":case"btn_close":o.WND_GAME.close();break;case"btn_no_snd":case"btn_snd":N();break}break}}else if(e=="start"){o.START_X=r;o.START_Y=i;var s=Math.floor((o.START_X-o.MAP_X)/o.EL_WIDTH);var u=Math.floor((o.START_Y-o.MAP_Y)/o.EL_HEIGHT);if(s>=0&&s<o.MAP_WIDTH&&u>=0&&u<o.MAP_HEIGHT){o.WND_GAME.non_pass();if(o.WND_GAME.on_click(s,u)>0){o.START_X=-1;o.WND_GAME.update_map()}}}else if(e=="move"){if(o.START_X<0)return;if(o.ELEMENT!=null){o.ELEMENT.sprite.position.x=o.ELEMENT.old_x*o.EL_WIDTH;o.ELEMENT.sprite.position.y=o.ELEMENT.old_y*o.EL_HEIGHT}var a=r-o.START_X;var f=i-o.START_Y;if(a==0&&f==0)return;if(Math.abs(a)>Math.abs(f)){if(a>0)a=1;else a=-1;f=0}else{if(f>0)f=1;else f=-1;a=0}var s=Math.floor((o.START_X-o.MAP_X)/o.EL_WIDTH);var u=Math.floor((o.START_Y-o.MAP_Y)/o.EL_HEIGHT);if(a!=0)o.PROG=Math.abs(r-o.START_X)/o.EL_WIDTH;else o.PROG=Math.abs(i-o.START_Y)/o.EL_HEIGHT;if(s>=0&&s<o.MAP_WIDTH&&u>=0&&u<o.MAP_HEIGHT&&s+a>=0&&s+a<o.MAP_WIDTH&&u+f>=0&&u+f<o.MAP_HEIGHT){o.WND_GAME.non_pass();o.WND_GAME.on_move(s,u,a,f);if(o.PROG>=.5){o.PROG=.5;o.WND_GAME.update_map()}else o.WND_GAME.on_set_position()}}else if(e=="finish"){if(o.START_X<0)return;var a=r-o.START_X;var f=i-o.START_Y;if(a==0&&f==0)return;if(Math.abs(a)>Math.abs(f)){if(a>0)a=1;else a=-1;f=0}else{if(f>0)f=1;else f=-1;a=0}var s=Math.floor((o.START_X-o.MAP_X)/o.EL_WIDTH);var u=Math.floor((o.START_Y-o.MAP_Y)/o.EL_HEIGHT);if(s>=0&&s<o.MAP_WIDTH&&u>=0&&u<o.MAP_HEIGHT&&s+a>=0&&s+a<o.MAP_WIDTH&&u+f>=0&&u+f<o.MAP_HEIGHT){o.WND_GAME.non_pass();o.WND_GAME.on_move(s,u,a,f);o.WND_GAME.update_map()}}}function O(){var e=this;this.set_property=function(e){var t=e*e;if(e<=2)c.INTRO.back_1.sprite.alpha=e/2;if(e>2&&e<=3){c.INTRO.back_1.sprite.alpha=1;t=e-2;t=Math.sqrt(t);i=1;c.INTRO["s_1_"+i].sprite.scale.y=2-t;c.INTRO["s_1_"+i].sprite.scale.x=2-t;c.INTRO["s_1_"+i].sprite.position.x=c.INTRO["s_1_"+i].x-c.INTRO["s_1_"+i].uni_width*(1-t)}if(e>2.5&&e<=3.5){i=2;t=e-2.5;t=Math.sqrt(t);c.INTRO["s_1_"+i].sprite.scale.y=2-t;c.INTRO["s_1_"+i].sprite.scale.x=2-t;c.INTRO["s_1_"+i].sprite.position.x=c.INTRO["s_1_"+i].x-i*c.INTRO["s_1_"+i].uni_width*(1-t)}if(e>3&&e<=4){i=3;t=e-3;t=Math.sqrt(t);c.INTRO["s_1_"+i].sprite.scale.y=2-t;c.INTRO["s_1_"+i].sprite.scale.x=2-t;c.INTRO["s_1_"+i].sprite.position.x=c.INTRO["s_1_"+i].x-i*c.INTRO["s_1_"+i].uni_width*(1-t)}if(e>3.5&&e<=4.5){i=4;t=e-3.5;t=Math.sqrt(t);c.INTRO["s_1_"+i].sprite.scale.y=2-t;c.INTRO["s_1_"+i].sprite.scale.x=2-t;c.INTRO["s_1_"+i].sprite.position.x=c.INTRO["s_1_"+i].x-i*c.INTRO["s_1_"+i].uni_width*(1-t)}if(e>4.5&&e<=6.5){c.INTRO.back_2.sprite.alpha=(e-4.5)/2;c.INTRO.up_2.sprite.visible=true}if(e>4.5&&e<=11){i=5;t=e-4.5;t=Math.sin(t*Math.PI*2.3);c.INTRO["s_1_"+i].sprite.position.x=c.INTRO["s_1_"+i].x+t*20;c.INTRO["s_1_"+i].sprite.position.y=c.INTRO["s_1_"+i].y+Math.abs(t)*20;c.INTRO["s_1_"+i].sprite.rotation=t/20}if(e>9&&e<=10){c.INTRO.back_3.sprite.alpha=e-9;c.INTRO.up_3.sprite.visible=true}if(e>9&&e<=11){i=6;t=(e-10)/2;c.INTRO["s_1_"+i].sprite.position.x=c.INTRO["s_1_"+i].x+(1-t)*30;c.INTRO["s_1_"+i].sprite.position.y=c.INTRO["s_1_"+i].y+(1-t)*15;c.INTRO["s_1_"+i].sprite.rotation=t/20}};this.finish=function(){o.AFTER_INTRO=true};this.start=function(){for(var t=1;t<5;t++){c.INTRO["s_1_"+t].sprite.scale.y=2;c.INTRO["s_1_"+t].sprite.scale.x=2;c.INTRO["s_1_"+t].sprite.position.x=c.INTRO["s_1_"+t].x-t*c.INTRO["s_1_"+t].uni_width}c.INTRO.back_1.sprite.visible=true;c.INTRO.back_1.sprite.alpha=0;c.INTRO.back_2.sprite.alpha=0;c.INTRO.back_3.sprite.alpha=0;c.INTRO.up_1.sprite.visible=true;c.INTRO.up_2.sprite.visible=false;c.INTRO.up_3.sprite.visible=false;c.ACT.start("show_intro",e,e.finish)}}function M(){function o(){this.x=0;this.y=0;this.active=false;this.time=0}function u(){if(s.length==0){s.push(c.GAME.sled);c.GAME.sled.sprite.visible=true;c.GAME.sled.sprite.anchor.x=.5;c.GAME.sled.sprite.anchor.y=.5;return c.GAME.sled}var e=c.GAME.sled.make_copy();s.push(e);c.GAME.dym_place.add(e);e.sprite.anchor.x=.5;e.sprite.anchor.y=.5;e.sprite.visible=true;return e}function a(t,r){var i=null;for(var o=0;o<s.length;o++){if(!s[o].sprite.visible){i=s[o];i.sprite.visible=true;break}}if(i==null)i=u();i.sprite.rotation=Math.random()*Math.PI*2;i.sprite.alpha=1;i.sprite.scale.x=1;i.sprite.scale.y=1;i.sprite.position.x=t+Math.random()*e/5;i.sprite.position.y=r+Math.random()*e/5;i.rot=Math.random()*Math.PI*2;i.time=(n+Math.random()*n/2)/3;i.max_time=i.time}function f(e,t){e.time-=t;if(e.time<=0){e.sprite.visible=false;return}e.sprite.alpha=e.time/e.max_time;e.sprite.scale.x=5-4*e.time/e.max_time;e.sprite.scale.y=5-4*e.time/e.max_time;e.sprite.rotation+=t*(.5-Math.random())/600;e.sprite.position.y-=t/100}function l(e){for(var n=0;n<r.length;n++){if(r[n].active){r[n].time-=e;if(r[n].time<=0){if(r[n].sled){r[n].time=t/10/r[n].rate;a(r[n].x,r[n].y)}}}}for(n=0;n<s.length;n++){if(s[n].sprite.visible){f(s[n],e)}}}var r=[];var i=[];var s=[];this.move=function(e,t,n){r[e].x=t;r[e].y=n};this.start=function(e,t,n,i){for(var s=0;s<r.length;s++){if(!r[s].active){r[s].active=true;r[s].time=1;r[s].x=e;r[s].y=t;r[s].sled=n;r[s].rate=i;return s}}r.push(new o);r[s].active=true;r[s].time=1;r[s].x=e;r[s].y=t;r[s].sled=n;r[s].rate=i;return s};this.finish=function(e){r[e].active=false};L(l)}function _(){function n(){this.set_property=function(n){if(t)return;c.MAIN.btn_start.sprite.scale.x=1+.1*n;c.MAIN.btn_start.sprite.scale.y=1-.1*n;c.CREDITS.btn_start.sprite.scale.x=1+.1*n;c.CREDITS.btn_start.sprite.scale.y=1-.1*n;c.TITLE.btn_start.sprite.scale.x=1+.1*n;c.TITLE.btn_start.sprite.scale.y=1-.1*n;if(o.AFTER_INTRO){c.INTRO.btn_start.sprite.scale.x=1+.1*n;c.INTRO.btn_start.sprite.scale.y=1-.1*n}if(e.level_btn!=null){e.level_btn.sprite.scale.x=1+.1*n;e.level_btn.sprite.scale.y=1-.1*n}}}function i(){if(t)return;c.ACT.start("ui_scale",r,i)}var e=this;var t=false;this.level_btn=null;c.MAIN.btn_start.center();c.CREDITS.btn_start.center();c.TITLE.btn_start.center();c.INTRO.btn_start.center();var r=new n;this.stop_scale_ui=function(){t=true};i()}function D(){function h(){var e=this;var t=0;var n=0;var r=0;var i=0;var s=false;var u=true;this.set_property=function(e){if(e<1/4){if(c.GAME.back_arrow.sprite.alpha<1)c.GAME.back_arrow.sprite.alpha=e*4;c.GAME.arrow.sprite.alpha=e*4;c.GAME.arrow.sprite.scale.x=2-e*4;c.GAME.arrow.sprite.scale.y=2-e*4}else{c.GAME.back_arrow.sprite.alpha=1;c.GAME.arrow.sprite.position.x=(t+(r-t)*(e-1/4)*4/3)*o.EL_WIDTH+o.EL_WIDTH/2;c.GAME.arrow.sprite.position.y=(n+(i-n)*(e-1/4)*4/3)*o.EL_HEIGHT+o.EL_HEIGHT/2;c.GAME.arrow.sprite.alpha=1-(e-1/4)*4/12;c.GAME.arrow.sprite.scale.x=1+(e-1/4)*4/12;c.GAME.arrow.sprite.scale.y=1+(e-1/4)*4/12}};this.stop=function(){s=false;c.GAME.help_place.sprite.visible=false};this.finish=function(){c.GAME.help_place.sprite.visible=false;u=true;if(s)e.start(t,n,r,i,1)};this.start=function(a,f,l,h,p){t=a;n=f;r=l;i=h;c.GAME.help_place.sprite.visible=true;c.GAME.arrow.sprite.position.x=a*o.EL_WIDTH+o.EL_WIDTH/2;c.GAME.arrow.sprite.position.y=f*o.EL_HEIGHT+o.EL_HEIGHT/2;c.GAME.arrow.sprite.alpha=0;c.GAME.back_arrow.sprite.position.x=a*o.EL_WIDTH+o.EL_WIDTH/2;c.GAME.back_arrow.sprite.position.y=f*o.EL_HEIGHT+o.EL_HEIGHT/2;c.GAME.back_arrow.sprite.alpha=p;s=true;if(u){c.ACT.start("tutor",e,e.finish);u=false}}}function d(){var e=this;var n=.03;this.napr=0;this.obj=null;this.uw=0;this.uh=0;this.set_property=function(t){e.obj.sprite.scale.x=1;e.obj.sprite.scale.y=1;switch(e.napr){case 0:e.obj.sprite.scale.y=1-n*t;break;case 1:e.obj.sprite.scale.x=1-n*t;e.obj.sprite.position.x=this.obj.scx+e.uw*n*t;break;case 2:e.obj.sprite.scale.y=1-n*t;e.obj.sprite.position.y=this.obj.scy+e.uh*n*t;break;case 3:e.obj.sprite.scale.x=1-n*t;break}};this.start=function(){for(var n=0;n<t.length;n++){var r=t[n];if(r!=null&&(r.x!=r.old_x||r.y!=r.old_y)){e.obj=r;this.obj.scx=this.obj.sprite.position.x;this.obj.scy=this.obj.sprite.position.y;if(r.x>r.old_x)e.napr=1;else if(r.x<r.old_x)e.napr=3;else if(r.y<r.old_y)e.napr=0;else e.napr=2;e.uw=r.uni_width;e.uh=r.uni_height;if(r.cb!=null){e.uw=r.cb.uni_width;e.uh=r.cb.uni_height;break}}}o.STEPS++;o.WND_GAME.tutorial.stop();c.ACT.start("scale",e,A)}}function g(e){c.GAME.wrays.sprite.rotation+=e/1500;if(o.SKACHKA)c.HERO_S.go.update(e);if(!o.RUN)return;c.GAME.txt_level.set_text("Level "+(1+o.CURRENT_LEVEL));c.GAME.txt_moves.set_text(""+o.STEPS);c.GAME.txt_step_1.set_text(""+o.STEP1);c.GAME.txt_step_2.set_text(""+o.STEP2);c.GAME.txt_step_3.set_text(""+o.STEP3);if(o.PRINCESS_PAUSE>0){o.PRINCESS_PAUSE-=e;if(o.PRINCESS_PAUSE<0)o.PRINCESS_PAUSE=0}else{if(c.PRINCESS.prnc.update(e)){o.PRINCESS_PAUSE=2e3}}c.HERO_S.stay.update(e);if(l>0){l-=e;if(l<=0)l=0;k((o.MOVE_TICK-l)/o.MOVE_TICK);if(l==0)v.start()}}function b(){for(var e=0;e<t.length;e++){var n=t[e];if(n!=null){var r=n.sprite.parent;if(r!=null){r.removeChild(n.sprite);r.addChild(n.sprite)}}}}function w(e,t,n,r){for(var i=0;i<c.DATA.blocks.length;i++){if(c.DATA.blocks[i].path==e&&c.DATA.blocks[i].path_2==t&&c.DATA.blocks[i].chain==n){return x.get_object("BLOCKS",c.DATA.blocks[i].block+"_"+r,null)}}return null}function E(){l=0;o.STEPS=0;if(c.HERO_S.go.sprite.parent!=null)c.HERO_S.go.sprite.parent.removeChild(c.HERO_S.go.sprite);c.HERO_S.stay.sprite.visible=true;c.GAME.start_3.sprite.visible=false;c.GAME.finish_3.sprite.visible=false;for(i=0;i<t.length;i++)if(t[i]!=null){if(t[i].cb!=null){x.free(t[i].cb);t[i].cb=null}x.free(t[i]);t[i]=null}var n=o.LEVELS[o.CURRENT_LEVEL];o.STEP1=n.steps_1;o.STEP2=n.steps_2;o.STEP3=n.steps_3;c.GAME.txt_moves.set_text("");c.GAME.txt_step_1.set_text("");c.GAME.txt_step_2.set_text("");c.GAME.txt_step_3.set_text("");o.SUFIX=n.sufix;var r=c.GAME[n.map_name];r.add(c.GAME["start"+o.SUFIX]);r.add(c.GAME["finish"+o.SUFIX]);o.MAP_X=r.sprite.position.x;o.MAP_Y=r.sprite.position.y;o.MAP_WIDTH=n.map_width;o.MAP_HEIGHT=n.map_height;o.EL_WIDTH=r.uni_width/n.map_width;o.EL_HEIGHT=r.uni_height/n.map_height;e.tutorial.stop();if(o.CURRENT_LEVEL==0)e.tutorial.start(2,1,2,2,0);c.GAME["start"+o.SUFIX].x=n.start_x;c.GAME["start"+o.SUFIX].y=n.start_y;if(c.GAME["start"+o.SUFIX].x<0){c.GAME["start"+o.SUFIX].x++;c.GAME["start"+o.SUFIX].path="path_3"+o.SUFIX}if(c.GAME["start"+o.SUFIX].x>=o.MAP_WIDTH){c.GAME["start"+o.SUFIX].x--;c.GAME["start"+o.SUFIX].path="path_1"+o.SUFIX}if(c.GAME["start"+o.SUFIX].y<0){c.GAME["start"+o.SUFIX].y++;c.GAME["start"+o.SUFIX].path="path_0"+o.SUFIX}if(c.GAME["start"+o.SUFIX].y>=o.MAP_HEIGHT){c.GAME["start"+o.SUFIX].y--;c.GAME["start"+o.SUFIX].path="path_2"+o.SUFIX}c.GAME["start"+o.SUFIX].sprite.position.x=n.start_x*o.EL_WIDTH+(o.EL_WIDTH-c.GAME["start"+o.SUFIX].uni_width)/2;c.GAME["start"+o.SUFIX].sprite.position.y=n.start_y*o.EL_HEIGHT+(o.EL_HEIGHT-c.GAME["start"+o.SUFIX].uni_height)/2;c.GAME["finish"+o.SUFIX].x=n.finish_x;c.GAME["finish"+o.SUFIX].y=n.finish_y;if(c.GAME["finish"+o.SUFIX].x<0){c.GAME["finish"+o.SUFIX].x++;c.GAME["finish"+o.SUFIX].path="path_3"+o.SUFIX}if(c.GAME["finish"+o.SUFIX].x>=o.MAP_WIDTH){c.GAME["finish"+o.SUFIX].x--;c.GAME["finish"+o.SUFIX].path="path_1"+o.SUFIX}if(c.GAME["finish"+o.SUFIX].y<0){c.GAME["finish"+o.SUFIX].y++;c.GAME["finish"+o.SUFIX].path="path_0"+o.SUFIX}if(c.GAME["finish"+o.SUFIX].y>=o.MAP_HEIGHT){c.GAME["finish"+o.SUFIX].y--;c.GAME["finish"+o.SUFIX].path="path_2"+o.SUFIX}c.GAME["finish"+o.SUFIX].sprite.position.x=n.finish_x*o.EL_WIDTH+(o.EL_WIDTH-c.GAME["finish"+o.SUFIX].uni_width)/2;c.GAME["finish"+o.SUFIX].sprite.position.y=n.finish_y*o.EL_HEIGHT+(o.EL_HEIGHT-c.GAME["finish"+o.SUFIX].uni_height)/2;c.GAME.cursor.sprite.position.x=o.MAP_X+o.EL_WIDTH/2;c.GAME.cursor.sprite.position.y=o.MAP_Y+o.EL_HEIGHT/2;o.EDIT_X=0;o.EDIT_Y=0;for(var s=0;s<n.map_height;s++)for(var u=0;u<n.map_width;u++){var a=n.blocks[u+s*n.map_width].id;if(a>=0){var f=x.get_object("GAME","block"+o.SUFIX,r);f.sprite.position.x=u*o.EL_WIDTH;f.sprite.position.y=s*o.EL_HEIGHT;f.cb=null;f.x=u;f.y=s;f.old_x=u;f.old_y=s;f.md=n.blocks[u+s*n.map_width].md;t[u+s*o.MAX_ARRAY]=f;for(i=0;i<4;i++){f["path_"+i+o.SUFIX].sprite.visible=a-Math.floor(a/2)*2==1;a=Math.floor(a/2)}f["nail"+o.SUFIX].sprite.visible=!n.blocks[u+s*n.map_width].mv;a=n.blocks[u+s*n.map_width].ch;for(i=0;i<4;i++){f["chain_"+i+o.SUFIX].sprite.visible=a-Math.floor(a/2)*2==1;a=Math.floor(a/2)}var h=n.blocks[u+s*n.map_width].id;var p=0;var d=n.blocks[u+s*n.map_width].ch;if(d==2){p=n.blocks[u+1+s*n.map_width].id}else if(d==4){p=n.blocks[u+(s+1)*n.map_width].id}var v=w(h,p,d,n.blocks[u+s*n.map_width].md);if(v){f["blocks_back"+o.SUFIX].sprite.visible=false;f.cb=v;f.add(v)}else{if(d==8&&t[u-1+s*o.MAX_ARRAY].cb!=null||d==1&&t[u+(s-1)*o.MAX_ARRAY].cb!=null)f["blocks_back"+o.SUFIX].sprite.visible=false;else f["blocks_back"+o.SUFIX].sprite.visible=true}}}}function S(e,n,r){var i=t[e+n*o.MAX_ARRAY];if(i!=null&&i[r].sprite.visible)return true;return false}function T(e,t,n){if(r[e+t*o.MAX_ARRAY]==1e6){r[e+t*o.MAX_ARRAY]=n;return true}if(r[e+t*o.MAX_ARRAY]>=0)return false;r[e+t*o.MAX_ARRAY]=n;if(e>0&&S(e,t,"path_3"+o.SUFIX)&&S(e-1,t,"path_1"+o.SUFIX)&&T(e-1,t,n+1))return true;if(e<o.MAP_WIDTH-1&&S(e,t,"path_1"+o.SUFIX)&&S(e+1,t,"path_3"+o.SUFIX)&&T(e+1,t,n+1))return true;if(t>0&&S(e,t,"path_0"+o.SUFIX)&&S(e,t-1,"path_2"+o.SUFIX)&&T(e,t-1,n+1))return true;if(t<o.MAP_HEIGHT-1&&S(e,t,"path_2"+o.SUFIX)&&S(e,t+1,"path_0"+o.SUFIX)&&T(e,t+1,n+1))return true}function N(){if(c.GAME.editor.sprite.visible)return false;for(var e=0;e<r.length;e++)r[e]=-1;r[c.GAME["finish"+o.SUFIX].x+c.GAME["finish"+o.SUFIX].y*o.MAX_ARRAY]=1e6;var n=t[c.GAME["finish"+o.SUFIX].x+c.GAME["finish"+o.SUFIX].y*o.MAX_ARRAY];var i=t[c.GAME["start"+o.SUFIX].x+c.GAME["start"+o.SUFIX].y*o.MAX_ARRAY];var s=false;if(n!=null&&n[c.GAME["finish"+o.SUFIX].path].sprite.visible&&i!=null&&i[c.GAME["start"+o.SUFIX].path].sprite.visible)s=T(c.GAME["start"+o.SUFIX].x,c.GAME["start"+o.SUFIX].y,0);if(s){for(e=0;e<o.PATH.length;e++)o.PATH[e]=-1;e=0;function u(t,n,i){if(t<0||n<0||t>o.MAP_WIDTH-1||n>o.MAP_HEIGHT-1||i<0)return;if(r[t+n*o.MAX_ARRAY]==i){o.PATH[e]=t;o.PATH[e+1]=n;e+=2;u(t-1,n,i-1);u(t+1,n,i-1);u(t,n-1,i-1);u(t,n+1,i-1)}}u(c.GAME["finish"+o.SUFIX].x,c.GAME["finish"+o.SUFIX].y,r[c.GAME["finish"+o.SUFIX].x+c.GAME["finish"+o.SUFIX].y*o.MAX_ARRAY])}return s}function C(e,n,r){if(e.pass)return;e.x=e.old_x;e.y=e.old_y;e.pass=true;for(var i=0;i<4;i++)if(e["chain_"+i+o.SUFIX].sprite.visible){switch(i){case 0:C(t[e.x+(e.y-1)*o.MAX_ARRAY],n,r);break;case 1:C(t[e.x+1+e.y*o.MAX_ARRAY],n,r);break;case 2:C(t[e.x+(e.y+1)*o.MAX_ARRAY],n,r);break;case 3:C(t[e.x-1+e.y*o.MAX_ARRAY],n,r);break}}e.x+=n;e.y+=r;e.sprite.position.x=(e.old_x+(e.x-e.old_x)*o.PROG)*o.EL_WIDTH;e.sprite.position.y=(e.old_y+(e.y-e.old_y)*o.PROG)*o.EL_HEIGHT}function k(e){for(var n=0;n<t.length;n++){var r=t[n];if(r!=null&&(r.x!=r.old_x||r.y!=r.old_y)){r.sprite.position.x=(r.old_x+(r.x-r.old_x)*e)*o.EL_WIDTH;r.sprite.position.y=(r.old_y+(r.y-r.old_y)*e)*o.EL_HEIGHT}}}function A(){for(var r=0;r<t.length;r++){if(t[r]!=null){n[t[r].x+t[r].y*o.MAX_ARRAY]=t[r]}}for(r=0;r<t.length;r++){var i=n[r];t[r]=i;if(i!=null){i.old_x=i.x;i.old_y=i.y}}c.GUI_BUSY=false;b();if(N())e.show_win()}function O(e){if(e.pass)return;e.pass=true;if(e["nail"+o.SUFIX].sprite.visible){s=false;u=false;a=false;f=false;return}var n=null;var r=null;var i=null;var l=null;var c=e.x;var h=e.y;if(c>0){i=t[c-1+h*o.MAX_ARRAY];if(i!=null){if(e["chain_3"+o.SUFIX].sprite.visible)O(i);else f=false}}else f=false;if(c<o.MAP_WIDTH-1){l=t[c+1+h*o.MAX_ARRAY];if(l!=null){if(e["chain_1"+o.SUFIX].sprite.visible)O(l);else u=false}}else u=false;if(h>0){n=t[c+(h-1)*o.MAX_ARRAY];if(n!=null){if(e["chain_0"+o.SUFIX].sprite.visible)O(n);else s=false}}else s=false;if(h<o.MAP_HEIGHT-1){r=t[c+(h+1)*o.MAX_ARRAY];if(r!=null){if(e["chain_2"+o.SUFIX].sprite.visible)O(r);else a=false}}else a=false}function M(){o.RUN=true}function _(){c.GAME.win.sprite.visible=false;c.GAME.shad.sprite.scale.x=10.2;c.GAME.shad.sprite.scale.y=10.2;c.GAME.shad.sprite.position.x=-10;c.GAME.shad.sprite.position.y=-10;c.GAME.shad.sprite.visible=false;c.GAME.wrays.sprite.visible=false;c.GAME.txt_level.set_text("");E()}function D(){var e=this;this.wnd=null;this.set_property=function(t){e.wnd.sprite.position.y=-this.wnd.uni_height+(this.wnd.y+this.wnd.uni_height)*t;c.GAME.shad.sprite.alpha=t};this.finish=function(){var e=c.GAME.wrays;e.sprite.visible=true;e.sprite.alpha=0;c.ACT.start("alpha",e);c.GUI_BUSY=false}}function P(){var e=this;var t;var n=0;var r;var i=2;var s=2.7;var u;var a;var f;var l;var h=0;this.set_property=function(e){if(u>i)c.HERO_S.go.sprite.scale.x=-1;else if(u<i)c.HERO_S.go.sprite.scale.x=1;c.HERO_S.go.sprite.position.x=(i+(u-i)*e)*o.EL_WIDTH+f;c.HERO_S.go.sprite.position.y=(s+(a-s)*e)*o.EL_HEIGHT+l;o.WND_EMITTERS.move(h,c.HERO_S.go.sprite.position.x+c.HERO_S.go.uni_width/2+c.GAME.go_place.sprite.position.x,c.HERO_S.go.sprite.position.y+c.HERO_S.go.uni_height+c.GAME.go_place.sprite.position.y);if(c.HERO_S.go.sprite.scale.x==-1)c.HERO_S.go.sprite.position.x+=c.HERO_S.go.uni_width};this.finish=function(){t--;if(t<=0){r();o.WND_EMITTERS.finish(h)}else{n+=2;i=u;s=a;u=o.PATH[n];a=o.PATH[n+1];if(u<0){u=1;a=-.7}c.ACT.start("finish_way",e,e.finish)}};this.start=function(p,d){i=2;s=2.7;u=o.PATH[0];a=o.PATH[1];c.GUI_BUSY=true;t=p;r=d;c.GAME.go_place.add(c.HERO_S.go);if(u>i)c.HERO_S.go.sprite.scale.x=-1;else c.HERO_S.go.sprite.scale.x=1;f=c.GAME.hero_place.sprite.position.x-i*o.EL_WIDTH-c.GAME.go_place.sprite.position.x;l=c.GAME.hero_place.sprite.position.y-s*o.EL_HEIGHT-c.GAME.go_place.sprite.position.y;c.HERO_S.go.sprite.visible=true;c.HERO_S.stay.sprite.visible=false;c.HERO_S.go.sprite.position.x=i*o.EL_WIDTH+f;c.HERO_S.go.sprite.position.y=s*o.EL_HEIGHT+l;if(c.HERO_S.go.sprite.scale.x==-1)c.HERO_S.go.sprite.position.x+=c.HERO_S.go.uni_width;n=0;c.ACT.start("finish_way",e,e.finish);o.SKACHKA=true;h=o.WND_EMITTERS.start(c.HERO_S.go.sprite.position.x+c.HERO_S.go.uni_width/2+c.GAME.go_place.sprite.position.x,c.HERO_S.go.sprite.position.y+c.HERO_S.go.uni_height+c.GAME.go_place.sprite.position.y,true,1)}}function H(){var e=this;var t;var n=0;this.set_property=function(e){if(e<1/4){if(!c.GAME.zv1.sprite.visible)c.GUI_BUSY=false;c.GAME.zv1.sprite.alpha=e*4;c.GAME.zv1.sprite.scale.x=3-8*e;c.GAME.zv1.sprite.scale.y=3-8*e;c.GAME.zv1.sprite.position.y=c.GAME.zv1.y*e*4}else if(e<2/4){if(!c.GAME.zv1.sprite.visible)c.GUI_BUSY=false;else if(n==0){n++}if(c.GAME.zv1.sprite.visible){c.GAME.win.sprite.scale.x=1-.05*Math.sin(Math.PI*(e-1/4)*4);c.GAME.win.sprite.scale.y=c.GAME.win.sprite.scale.x;c.GAME.win.sprite.position.x=c.GAME.win.x+c.SCREEN_WIDTH*(1-c.GAME.win.sprite.scale.x)/2;c.GAME.win.sprite.position.y=c.GAME.win.y+c.SCREEN_HEIGHT*(1-c.GAME.win.sprite.scale.y)/2;if(t==0){c.GAME.zv1.sprite.alpha=1;c.GAME.zv1.sprite.scale.x=1;c.GAME.zv1.sprite.scale.y=1;c.GAME.zv1.sprite.position.y=c.GAME.zv1.y;t++}}else{c.GAME.win.sprite.scale.x=1;c.GAME.win.sprite.scale.y=1;c.GAME.win.sprite.position.x=c.GAME.win.x;c.GAME.win.sprite.position.y=c.GAME.win.y}c.GAME.zv1.sprite.alpha=1;c.GAME.zv2.sprite.alpha=(e-1/4)*4;c.GAME.zv2.sprite.scale.x=3-8*(e-1/4);c.GAME.zv2.sprite.scale.y=3-8*(e-1/4);c.GAME.zv2.sprite.position.y=c.GAME.zv2.y*(e-1/4)*4}else if(e<3/4){if(!c.GAME.zv2.sprite.visible)c.GUI_BUSY=false;else if(n==1){n++}if(c.GAME.zv2.sprite.visible){c.GAME.win.sprite.scale.x=1-.1*Math.sin(Math.PI*(e-2/4)*4);c.GAME.win.sprite.scale.y=c.GAME.win.sprite.scale.x;c.GAME.win.sprite.position.x=c.GAME.win.x+c.SCREEN_WIDTH*(1-c.GAME.win.sprite.scale.x)/2;c.GAME.win.sprite.position.y=c.GAME.win.y+c.SCREEN_HEIGHT*(1-c.GAME.win.sprite.scale.y)/2;if(t==1){c.GAME.zv2.sprite.position.y=c.GAME.zv2.y;c.GAME.zv2.sprite.alpha=1;c.GAME.zv2.sprite.scale.x=1;c.GAME.zv2.sprite.scale.y=1;t++}}else{c.GAME.win.sprite.scale.x=1;c.GAME.win.sprite.scale.y=1;c.GAME.win.sprite.position.x=c.GAME.win.x;c.GAME.win.sprite.position.y=c.GAME.win.y}c.GAME.zv3.sprite.alpha=(e-2/4)*4;c.GAME.zv3.sprite.scale.x=3-8*(e-2/4);c.GAME.zv3.sprite.scale.y=3-8*(e-2/4);c.GAME.zv3.sprite.position.y=c.GAME.zv3.y*(e-2/4)*4}else{if(c.GAME.zv3.sprite.visible){c.GAME.win.sprite.scale.x=1-.15*Math.sin(Math.PI*(e-3/4)*4);c.GAME.win.sprite.scale.y=c.GAME.win.sprite.scale.x;c.GAME.win.sprite.position.x=c.GAME.win.x+c.SCREEN_WIDTH*(1-c.GAME.win.sprite.scale.x)/2;c.GAME.win.sprite.position.y=c.GAME.win.y+c.SCREEN_HEIGHT*(1-c.GAME.win.sprite.scale.y)/2;if(t==2){c.GAME.zv3.sprite.position.y=c.GAME.zv3.y;c.GAME.zv3.sprite.alpha=1;c.GAME.zv3.sprite.scale.x=1;c.GAME.zv3.sprite.scale.y=1;t++}}else{c.GAME.win.sprite.scale.x=1;c.GAME.win.sprite.scale.y=1;c.GAME.win.sprite.position.x=c.GAME.win.x;c.GAME.win.sprite.position.y=c.GAME.win.y}}};this.finish=function(){c.GAME.win.sprite.scale.x=1;c.GAME.win.sprite.scale.y=1;c.GAME.win.sprite.position.x=c.GAME.win.x;c.GAME.win.sprite.position.y=c.GAME.win.y;c.GUI_BUSY=false};this.start=function(){c.GUI_BUSY=true;t=0;n=0;c.GAME.zv1.sprite.visible=o.PROGRESS[o.CURRENT_LEVEL]>0;c.GAME.zv2.sprite.visible=o.PROGRESS[o.CURRENT_LEVEL]>1;c.GAME.zv3.sprite.visible=o.PROGRESS[o.CURRENT_LEVEL]>2;c.GAME.zv1.sprite.alpha=0;c.GAME.zv2.sprite.alpha=0;c.GAME.zv3.sprite.alpha=0;c.GAME.zv1.sprite.position.y=0;c.GAME.zv2.sprite.position.y=0;c.GAME.zv3.sprite.position.y=0;c.ACT.start("show_zw",e,e.finish)}}var e=this;var t=new Array(o.MAX_ARRAY*o.MAX_ARRAY);this.external_map=t;var n=new Array(o.MAX_ARRAY*o.MAX_ARRAY);var r=new Array(o.MAX_ARRAY*o.MAX_ARRAY);var s=false;var u=false;var a=false;var f=false;var l=0;this.tutorial=new h;this.tutorial.stop();var v=new d;L(g);this.update_map=function(){o.START_X=-1;for(var e=0;e<t.length;e++)if(t[e]!=null&&e!=t[e].x+t[e].y*o.MAX_ARRAY){l=o.MOVE_TICK-o.MOVE_TICK*o.PROG;if(l==0)l++;c.GUI_BUSY=true}};this.on_click=function(n,r){if(c.GAME.editor.sprite.visible){if(o.EDIT_X!=n||o.EDIT_Y!=r){o.EDIT_X=n;o.EDIT_Y=r;c.GAME.cursor.sprite.position.x=o.MAP_X+o.EL_WIDTH*(n+.5);c.GAME.cursor.sprite.position.y=o.MAP_Y+o.EL_HEIGHT*(r+.5);return 1}}var i=t[n+r*o.MAX_ARRAY];o.ELEMENT=i;return-1;if(i!=null){if(i["nail"+o.SUFIX].sprite.visible)return-1;s=true;u=true;a=true;f=true;O(i);var l=0;var h=0;var p=0;if(s){h=-1;p++}if(u){l=1;p++}if(a){h=1;p++}if(f){l=-1;p++}if(p!=1)return-1;var d=l+1+10*(h+1);e.non_pass();C(i,l,h);return d}};this.non_pass=function(){for(var e=0;e<t.length;e++){if(t[e]!=null)t[e].pass=false;n[e]=null}};this.on_set_position=function(){for(var e=0;e<t.length;e++){var n=t[e];if(n!=null){n.sprite.position.x=(n.old_x+(n.x-n.old_x)*o.PROG)*o.EL_WIDTH;n.sprite.position.y=(n.old_y+(n.y-n.old_y)*o.PROG)*o.EL_HEIGHT;n.x=n.old_x;n.y=n.old_y}}};this.on_move=function(n,r,i,l){if(c.GAME.editor.sprite.visible){if(o.EDIT_X!=n||o.EDIT_Y!=r){o.EDIT_X=n;o.EDIT_Y=r;c.GAME.cursor.sprite.position.x=o.MAP_X+o.EL_WIDTH*(n+.5);c.GAME.cursor.sprite.position.y=o.MAP_Y+o.EL_HEIGHT*(r+.5);return}}var h=t[n+r*o.MAX_ARRAY];o.ELEMENT=h;if(h==null)return;s=true;u=true;a=true;f=true;O(h);if(i==0){if(l==-1&&!s)return;else if(l==1&&!a)return}else{if(i==-1&&!f)return;else if(i==1&&!u)return}e.non_pass();C(h,i,l)};this.restart=function(){_();M()};this.next=function(){if(o.CURRENT_LEVEL<o.LEVELS.length-1){o.CURRENT_LEVEL++;_();M()}else e.close()};this.refresh=function(){o.START_X=-1;o.ELEMENT=null;_();M()};this.show=function(){_();o.SHOW_HANDLER=M;m(c.GAME);c.GAME.txt_level.set_text("Level "+(1+o.CURRENT_LEVEL))};this.close=function(){o.RUN=false;y()};this.wnd=new D;this.finish=new P;var B=new H;this.show_win=function(){function n(){if(o.CURRENT_LEVEL<19){c.GAME.compl.sprite.visible=false;c.GAME.prog.sprite.visible=true}else{c.GAME.compl.sprite.visible=true;c.GAME.prog.sprite.visible=false}o.SKACHKA=false;o.RUN=false;c.GUI_BUSY=true;c.GAME.win.sprite.visible=true;c.GAME.win.sprite.position.y=-c.GAME.win.uni_height;e.wnd.wnd=c.GAME.win;c.ACT.start("pr",e.wnd,e.wnd.finish);B.start()}if(o.STEPS<=o.STEP1){if(o.PROGRESS[o.CURRENT_LEVEL]<3)o.PROGRESS[o.CURRENT_LEVEL]=3}else if(o.STEPS<=o.STEP2){if(o.PROGRESS[o.CURRENT_LEVEL]<2)o.PROGRESS[o.CURRENT_LEVEL]=2}else if(o.STEPS<=o.STEP3){if(o.PROGRESS[o.CURRENT_LEVEL]<1)o.PROGRESS[o.CURRENT_LEVEL]=1}else{if(o.PROGRESS[o.CURRENT_LEVEL]<0)o.PROGRESS[o.CURRENT_LEVEL]=0}if(o.CURRENT_LEVEL+1<o.PROGRESS.length){if(o.PROGRESS[o.CURRENT_LEVEL+1]<-1)o.PROGRESS[o.CURRENT_LEVEL+1]=-1}p();window._myScorePlay68=o.CURRENT_LEVEL+1;updateShare(window._myScorePlay68);Play68.setRankingScoreDesc(window._myScorePlay68);var t=1;for(i=0;i<o.PATH.length;i+=2)if(o.PATH[i]>=0)t++;o.WND_GAME.finish.start(t,n)};this.show_loose=function(){o.RUN=false}}function P(){function t(){}var e=this;this.show=function(){v(c.CREDITS)};this.close=function(){g()}}function H(){function i(){if(!o.INTRO_SHOWED){f[f.length-2]=f[f.length-1];f.pop();o.INTRO_SHOWED=true}}function s(){var e=o.LEVELS[o.CURRENT_LEVEL];for(var t=0;t<e.blocks.length;t++){e.blocks[t].mx=true;e.blocks[t].ch=0;e.blocks[t].id=-1}for(var n=0;n<e.map_width;n++)for(var r=0;r<e.map_height;r++){var i=o.WND_GAME.external_map[n+r*o.MAX_ARRAY];if(i!=null){var s=0;for(t=3;t>=0;t--){s*=2;if(i["path_"+t+o.SUFIX].sprite.visible)s++}e.blocks[n+r*e.map_width].id=s;e.blocks[n+r*e.map_width].mv=!i["nail"+o.SUFIX].sprite.visible;s=0;for(t=3;t>=0;t--){s*=2;if(i["chain_"+t+o.SUFIX].sprite.visible)s++}e.blocks[n+r*e.map_width].ch=s}}}function u(){o.LEVELS=AVK_MAP}var e=this;var t=0;var n=0;var r=0;c.GAME.btn_edit_2.sprite.visible=false;c.GAME.btn_edit_3.sprite.visible=false;c.GAME.btn_edit_4.sprite.visible=false;c.LEVELS.btn.sprite.visible=false;c.GAME.cursor.sprite.anchor.x=.5;c.GAME.cursor.sprite.anchor.y=.5;this.erase=function(){s();var e=o.LEVELS[o.CURRENT_LEVEL];if(e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].id>=0){e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].id=-1;if((e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].ch&1)>0)e.blocks[o.EDIT_X+(o.EDIT_Y-1)*e.map_width].ch=e.blocks[o.EDIT_X+(o.EDIT_Y-1)*e.map_width].ch^4;if((e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].ch&2)>0)e.blocks[o.EDIT_X+1+o.EDIT_Y*e.map_width].ch=e.blocks[o.EDIT_X+1+o.EDIT_Y*e.map_width].ch^8;if((e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].ch&4)>0)e.blocks[o.EDIT_X+(o.EDIT_Y+1)*e.map_width].ch=e.blocks[o.EDIT_X+(o.EDIT_Y+1)*e.map_width].ch^1;if((e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].ch&8)>0)e.blocks[o.EDIT_X-1+o.EDIT_Y*e.map_width].ch=e.blocks[o.EDIT_X-1+o.EDIT_Y*e.map_width].ch^2;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].ch=0;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].mv=true;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].md=0}else{e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].id=0;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].ch=0;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].mv=true;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].md=0}var t=o.EDIT_X;var n=o.EDIT_Y;o.WND_GAME.refresh();o.EDIT_X=t;o.EDIT_Y=n;c.GAME.cursor.sprite.position.x=o.MAP_X+o.EL_WIDTH*(t+.5);c.GAME.cursor.sprite.position.y=o.MAP_Y+o.EL_HEIGHT*(n+.5)};this.nail=function(){s();var e=o.LEVELS[o.CURRENT_LEVEL];if(e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].id>=0){e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].mv=!e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].mv;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].md=0}else{e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].id=0;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].ch=0;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].mv=false;e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width].md=0}var t=o.EDIT_X;var n=o.EDIT_Y;o.WND_GAME.refresh();o.EDIT_X=t;o.EDIT_Y=n;c.GAME.cursor.sprite.position.x=o.MAP_X+o.EL_WIDTH*(t+.5);c.GAME.cursor.sprite.position.y=o.MAP_Y+o.EL_HEIGHT*(n+.5)};this.set_chain=function(e){s();var t=o.LEVELS[o.CURRENT_LEVEL];if(t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].md=0;switch(e){case 1:if(o.EDIT_Y>0&&t.blocks[o.EDIT_X+(o.EDIT_Y-1)*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch^e;t.blocks[o.EDIT_X+(o.EDIT_Y-1)*t.map_width].ch=t.blocks[o.EDIT_X+(o.EDIT_Y-1)*t.map_width].ch^4}break;case 2:if(o.EDIT_X<o.MAP_WIDTH-1&&t.blocks[o.EDIT_X+1+o.EDIT_Y*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch^e;t.blocks[o.EDIT_X+1+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+1+o.EDIT_Y*t.map_width].ch^8}break;case 4:if(o.EDIT_Y<o.MAP_HEIGHT-1&&t.blocks[o.EDIT_X+(o.EDIT_Y+1)*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch^e;t.blocks[o.EDIT_X+(o.EDIT_Y+1)*t.map_width].ch=t.blocks[o.EDIT_X+(o.EDIT_Y+1)*t.map_width].ch^1}break;case 8:if(o.EDIT_X>0&&t.blocks[o.EDIT_X-1+o.EDIT_Y*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch^e;t.blocks[o.EDIT_X-1+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X-1+o.EDIT_Y*t.map_width].ch^2}break}}else{t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].id=0;t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=0;t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].md=0;t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].mv=true;switch(e){case 1:if(o.EDIT_Y>0&&t.blocks[o.EDIT_X+(o.EDIT_Y-1)*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch^e;t.blocks[o.EDIT_X+(o.EDIT_Y-1)*t.map_width].ch=t.blocks[o.EDIT_X+(o.EDIT_Y-1)*t.map_width].ch^4}break;case 2:if(o.EDIT_X<o.MAP_WIDTH-1&&t.blocks[o.EDIT_X+1+o.EDIT_Y*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch^e;t.blocks[o.EDIT_X+1+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+1+o.EDIT_Y*t.map_width].ch^8}break;case 4:if(o.EDIT_Y<o.MAP_HEIGHT-1&&t.blocks[o.EDIT_X+(o.EDIT_Y+1)*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch^e;t.blocks[o.EDIT_X+(o.EDIT_Y+1)*t.map_width].ch=t.blocks[o.EDIT_X+(o.EDIT_Y+1)*t.map_width].ch^1}break;case 8:if(o.EDIT_X>0&&t.blocks[o.EDIT_X-1+o.EDIT_Y*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch^e;t.blocks[o.EDIT_X-1+o.EDIT_Y*t.map_width].ch=t.blocks[o.EDIT_X-1+o.EDIT_Y*t.map_width].ch^2}break}}var n=o.EDIT_X;var r=o.EDIT_Y;o.WND_GAME.refresh();o.EDIT_X=n;o.EDIT_Y=r;c.GAME.cursor.sprite.position.x=o.MAP_X+o.EL_WIDTH*(n+.5);c.GAME.cursor.sprite.position.y=o.MAP_Y+o.EL_HEIGHT*(r+.5)};this.change=function(){s();var e=o.LEVELS[o.CURRENT_LEVEL];var t=e.blocks[o.EDIT_X+o.EDIT_Y*e.map_width];var n=t.id;var r=0;var i=t.ch;var u=0;if(i==2){r=t.id}else if(i==4){r=t.id}for(var a=0;a<c.DATA.blocks.length;a++){if(c.DATA.blocks[a].path==n&&c.DATA.blocks[a].path_2==r&&c.DATA.blocks[a].chain==i){u=c.DATA.blocks[a].var}}t.md++;if(t.md>=u)t.md=0;var f=o.EDIT_X;var l=o.EDIT_Y;o.WND_GAME.refresh();o.EDIT_X=f;o.EDIT_Y=l;c.GAME.cursor.sprite.position.x=o.MAP_X+o.EL_WIDTH*(f+.5);c.GAME.cursor.sprite.position.y=o.MAP_Y+o.EL_HEIGHT*(l+.5)};this.set_path=function(e){s();var t=o.LEVELS[o.CURRENT_LEVEL];if(t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].id>=0){t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].id=t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].id^e;t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].md=0}else{t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].id=e;t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].ch=0;t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].mv=true;t.blocks[o.EDIT_X+o.EDIT_Y*t.map_width].md=0}var n=o.EDIT_X;var r=o.EDIT_Y;o.WND_GAME.refresh();o.EDIT_X=n;o.EDIT_Y=r;c.GAME.cursor.sprite.position.x=o.MAP_X+o.EL_WIDTH*(n+.5);c.GAME.cursor.sprite.position.y=o.MAP_Y+o.EL_HEIGHT*(r+.5)};this.add_level=function(){o.LEVELS.push({sufix:"_3",map_name:"game_place",map_width:3,map_height:3,start_x:1,start_y:-1,finish_x:2,finish_y:3,blocks:[{mv:true,ch:0,id:-1},{mv:true,ch:0,id:-1},{mv:true,ch:0,id:-1},{mv:true,ch:0,id:-1},{mv:true,ch:0,id:-1},{mv:true,ch:0,id:-1},{mv:true,ch:0,id:-1},{mv:true,ch:0,id:-1},{mv:true,ch:0,id:-1}]});var i=x.get_object("LEVELS","btn",c.LEVELS.place);i.sprite.position.x=t;i.sprite.position.y=n;i.txt_num.set_style(1,"AVK_FNT_main","center");i.txt_num.set_text(r+1+"");t+=i.uni_width*1.5;if(t+i.uni_width>c.LEVELS.place.uni_width){t=0;n+=i.uni_height*1.5}r++;e.save()};u();this.save=function(){s();var e=JSON.stringify(o.LEVELS);$$a({type:"post",url:"save_map.php",data:{data:e},response:"text",success:function(e){alert(e)}})};this.edit=function(){s();c.GAME.editor.sprite.visible=!c.GAME.editor.sprite.visible};this.show=function(){c.GAME.editor.sprite.visible=false;c.LEVELS.btn.sprite.visible=false;o.SHOW_HANDLER=i;m(c.LEVELS);if(c.LEVELS.place.sprite.children.length==0){}};this.close=function(){y()}}Visibility.change(function(e,t){if(t=="hidden")pauseGame();else if(PAUSED)resumeGame()});(function(e,t,n,r,i,s,o){e["GoogleAnalyticsObject"]=i;e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date;s=t.createElement(n),o=t.getElementsByTagName(n)[0];s.async=1;s.src=r;o.parentNode.insertBefore(s,o)})(window,document,"script","analytics.js","ga");ga("create","UA-52171562-3","auto");ga("send","pageview");var e=10;var t=1e3;var n=3500;var r={id:"576742227280292394"};var o=new s;GameAPI.loadAPI(u,r);var a=this;var f=[];var l=[];var c=new AVK_GAME(C,k,A);var h={to_left:{pause:0,time:350,changes:{global_x:{beg:0,end:-1,trans:"sqrt"}}},from_right:{pause:0,time:350,changes:{global_x:{beg:1,end:0,trans:"sqrt"}}},to_right:{pause:0,time:350,changes:{global_x:{beg:0,end:1,trans:"sqrt"}}},from_left:{pause:0,time:350,changes:{global_x:{beg:-1,end:0,trans:"sqrt"}}},scale:{pause:0,time:150,changes:{prop:{beg:0,end:Math.PI,trans:"sin"}}},ui_scale:{pause:0,time:1e3,changes:{prop:{beg:0,end:Math.PI*2,trans:"sin"}}},scale_life:{pause:0,time:250,changes:{scale:{beg:0,end:1,trans:"sqrt"}}},tryaska:{pause:0,time:500,changes:{prop:{beg:0,end:1,trans:"lin"}}},alpha:{pause:0,time:1e3,changes:{alpha:{beg:0,end:1,trans:"lin"}}},finish_way:{pause:0,time:400,changes:{prop:{beg:0,end:1,trans:"lin"}}},show_zw:{pause:400,time:1e3,changes:{prop:{beg:0,end:1,trans:"lin"}}},show_intro:{pause:300,time:7e3,changes:{prop:{beg:0,end:11,trans:"lin"}}},tutor:{pause:1e3,time:700,changes:{prop:{beg:0,end:1,trans:"n2"}}},pr:{pause:0,time:350,changes:{prop:{beg:0,end:1,trans:"sqrt"}}}};var x=new S;o.WND_INTRO=new O}var PLAYSOUND=false;var PAUSED=false